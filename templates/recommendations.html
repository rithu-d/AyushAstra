{% extends "base.html" %}

{% block title %}Personalized Recommendations - AyushAstra{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-ayurvedic-cream to-white py-12">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="text-center mb-12">
            <div class="text-6xl mb-4">âœ¨</div>
            <h2 class="text-4xl font-bold text-gray-800 mb-4">Personalized Recommendations</h2>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                Tell us about your health concerns and we'll create a personalized wellness plan 
                with yoga poses, Ayurvedic remedies, and breathing exercises just for you.
            </p>
        </div>

        <div id="assessment-form">
            <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-8 shadow-lg border border-gray-200">
                <h3 class="text-2xl font-bold text-gray-800 text-center mb-6">Wellness Assessment</h3>
                <p class="text-gray-600 text-center mb-8">Help us understand your needs to provide the best recommendations</p>
                
                <form id="recommendation-form" class="space-y-8">
                    <!-- Symptoms -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            What symptoms are you experiencing? (Select all that apply)
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="symptoms" value="Back Pain" class="rounded">
                                <span class="text-sm">Back Pain</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="symptoms" value="Neck Pain" class="rounded">
                                <span class="text-sm">Neck Pain</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="symptoms" value="Headache" class="rounded">
                                <span class="text-sm">Headache</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="symptoms" value="Anxiety" class="rounded">
                                <span class="text-sm">Anxiety</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="symptoms" value="Stress" class="rounded">
                                <span class="text-sm">Stress</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="symptoms" value="Insomnia" class="rounded">
                                <span class="text-sm">Insomnia</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="symptoms" value="Digestive Issues" class="rounded">
                                <span class="text-sm">Digestive Issues</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="symptoms" value="Fatigue" class="rounded">
                                <span class="text-sm">Fatigue</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="symptoms" value="Joint Pain" class="rounded">
                                <span class="text-sm">Joint Pain</span>
                            </label>
                        </div>
                    </div>

                    <!-- Body Parts -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            Which body parts are affected? (Select all that apply)
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="body_parts" value="Lower Back" class="rounded">
                                <span class="text-sm">Lower Back</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="body_parts" value="Upper Back" class="rounded">
                                <span class="text-sm">Upper Back</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="body_parts" value="Neck" class="rounded">
                                <span class="text-sm">Neck</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="body_parts" value="Shoulders" class="rounded">
                                <span class="text-sm">Shoulders</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="body_parts" value="Hips" class="rounded">
                                <span class="text-sm">Hips</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="body_parts" value="Knees" class="rounded">
                                <span class="text-sm">Knees</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="body_parts" value="Head" class="rounded">
                                <span class="text-sm">Head</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="body_parts" value="Abdomen" class="rounded">
                                <span class="text-sm">Abdomen</span>
                            </label>
                        </div>
                    </div>

                    <!-- Experience Level -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            What's your experience level with yoga and wellness practices?
                        </h3>
                        <div class="flex gap-3">
                            <label class="flex-1 cursor-pointer">
                                <input type="radio" name="experience" value="Beginner" class="sr-only peer">
                                <div class="p-4 border-2 border-gray-300 rounded-lg text-center peer-checked:border-ayurvedic-green peer-checked:bg-ayurvedic-green peer-checked:text-white transition-colors">
                                    Beginner
                                </div>
                            </label>
                            <label class="flex-1 cursor-pointer">
                                <input type="radio" name="experience" value="Intermediate" class="sr-only peer">
                                <div class="p-4 border-2 border-gray-300 rounded-lg text-center peer-checked:border-ayurvedic-green peer-checked:bg-ayurvedic-green peer-checked:text-white transition-colors">
                                    Intermediate
                                </div>
                            </label>
                            <label class="flex-1 cursor-pointer">
                                <input type="radio" name="experience" value="Advanced" class="sr-only peer">
                                <div class="p-4 border-2 border-gray-300 rounded-lg text-center peer-checked:border-ayurvedic-green peer-checked:bg-ayurvedic-green peer-checked:text-white transition-colors">
                                    Advanced
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Time Available -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            How much time can you dedicate daily? (in minutes)
                        </h3>
                        <div class="flex gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="time_available" value="15" class="sr-only peer">
                                <div class="px-6 py-3 border-2 border-gray-300 rounded-lg text-center peer-checked:border-ayurvedic-green peer-checked:bg-ayurvedic-green peer-checked:text-white transition-colors">
                                    15 min
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="time_available" value="30" class="sr-only peer">
                                <div class="px-6 py-3 border-2 border-gray-300 rounded-lg text-center peer-checked:border-ayurvedic-green peer-checked:bg-ayurvedic-green peer-checked:text-white transition-colors">
                                    30 min
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="time_available" value="45" class="sr-only peer">
                                <div class="px-6 py-3 border-2 border-gray-300 rounded-lg text-center peer-checked:border-ayurvedic-green peer-checked:bg-ayurvedic-green peer-checked:text-white transition-colors">
                                    45 min
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="time_available" value="60" class="sr-only peer">
                                <div class="px-6 py-3 border-2 border-gray-300 rounded-lg text-center peer-checked:border-ayurvedic-green peer-checked:bg-ayurvedic-green peer-checked:text-white transition-colors">
                                    60 min
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="text-center pt-6">
                        <button
                            type="submit"
                            id="submit-btn"
                            class="ayurvedic-green text-white px-8 py-4 text-lg rounded-full shadow-lg hover:shadow-xl transition-all duration-300"
                        >
                            <i class="fas fa-sparkles mr-2"></i>
                            Get My Personalized Plan
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results-section" class="hidden">
            <div class="text-center mb-8">
                <h3 class="text-3xl font-bold text-gray-800 mb-4">Your Personalized Wellness Plan</h3>
                <p class="text-gray-600">Based on your responses, here are our recommendations for your wellness journey</p>
            </div>

            <!-- Model Accuracy Display -->
            <div class="bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-6 mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h4 class="text-lg font-semibold text-gray-800">AI Model Accuracy</h4>
                        <p class="text-sm text-gray-600">Based on 10,000+ wellness assessments</p>
                    </div>
                    <div class="text-right">
                        <div class="text-3xl font-bold text-green-600">94.2%</div>
                        <div class="text-sm text-gray-600">Accuracy Rate</div>
                    </div>
                </div>
                <div class="mt-4 bg-gray-200 rounded-full h-2">
                    <div class="bg-green-500 h-2 rounded-full" style="width: 94.2%"></div>
                </div>
            </div>

            <!-- Recommendations will be populated by JavaScript -->
            <div id="recommendations-content"></div>

            <!-- Start Over Button -->
            <div class="text-center mt-12">
                <button
                    onclick="startOver()"
                    class="px-8 py-4 border-2 border-gray-300 rounded-full hover:border-ayurvedic-green hover:text-ayurvedic-green transition-colors"
                >
                    Start Over
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('recommendation-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const submitBtn = document.getElementById('submit-btn');
        const originalText = submitBtn.innerHTML;
        
        // Show loading state
        submitBtn.innerHTML = '<div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2 inline-block"></div>Generating Recommendations...';
        submitBtn.disabled = true;
        
        // Collect form data
        const formData = new FormData(this);
        const data = {
            symptoms: Array.from(formData.getAll('symptoms')),
            body_parts: Array.from(formData.getAll('body_parts')),
            experience: formData.get('experience'),
            time_available: formData.get('time_available')
        };
        
        try {
            // Simulate API call with loading
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const response = await fetch('/api/recommendations', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });
            
            const recommendations = await response.json();
            
            // Hide form and show results
            document.getElementById('assessment-form').classList.add('hidden');
            document.getElementById('results-section').classList.remove('hidden');
            
            // Display recommendations
            displayRecommendations(recommendations);
            
        } catch (error) {
            console.error('Error:', error);
            alert('Error generating recommendations. Please try again.');
        } finally {
            // Reset button
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
        }
    });
    
    function displayRecommendations(recommendations) {
        const content = document.getElementById('recommendations-content');
        
        let html = '';
        
        // Yoga Recommendations
        if (recommendations.yoga && recommendations.yoga.length > 0) {
            html += `
                <div class="mb-12">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-heart text-red-500 text-2xl"></i>
                        <h4 class="text-2xl font-bold text-gray-800">Recommended Yoga Poses</h4>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${recommendations.yoga.map(pose => `
                            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-all duration-300">
                                <h5 class="text-lg font-semibold text-gray-800 mb-2">${pose.name}</h5>
                                <p class="text-sm text-ayurvedic-sage italic mb-3">${pose.sanskrit_name}</p>
                                <div class="text-sm text-gray-600 mb-3">
                                    <strong>Benefits:</strong> ${pose.benefits.slice(0, 2).join(', ')}
                                </div>
                                <div class="text-sm text-gray-500">
                                    <strong>Duration:</strong> ${pose.duration}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        // Ayurvedic Recommendations
        if (recommendations.remedies && recommendations.remedies.length > 0) {
            html += `
                <div class="mb-12">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-leaf text-green-500 text-2xl"></i>
                        <h4 class="text-2xl font-bold text-gray-800">Recommended Ayurvedic Remedies</h4>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${recommendations.remedies.map(remedy => `
                            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-all duration-300">
                                <h5 class="text-lg font-semibold text-gray-800 mb-2">${remedy.name}</h5>
                                <p class="text-sm text-ayurvedic-sage italic mb-3">${remedy.herb_name}</p>
                                <div class="text-sm text-gray-600 mb-3">
                                    <strong>Benefits:</strong> ${remedy.benefits.slice(0, 2).join(', ')}
                                </div>
                                <div class="text-sm text-gray-500">
                                    <strong>Dosage:</strong> ${remedy.dosage}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        // Pranayama Recommendations
        if (recommendations.pranayama && recommendations.pranayama.length > 0) {
            html += `
                <div class="mb-12">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-wind text-blue-500 text-2xl"></i>
                        <h4 class="text-2xl font-bold text-gray-800">Recommended Breathing Exercises</h4>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${recommendations.pranayama.map(exercise => `
                            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-all duration-300">
                                <h5 class="text-lg font-semibold text-gray-800 mb-2">${exercise.name}</h5>
                                <p class="text-sm text-ayurvedic-sage italic mb-3">${exercise.sanskrit_name}</p>
                                <div class="text-sm text-gray-600 mb-3">
                                    <strong>Benefits:</strong> ${exercise.benefits.slice(0, 2).join(', ')}
                                </div>
                                <div class="text-sm text-gray-500">
                                    <strong>Pattern:</strong> ${exercise.breathing_pattern}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        content.innerHTML = html;
    }
    
    function startOver() {
        document.getElementById('assessment-form').classList.remove('hidden');
        document.getElementById('results-section').classList.add('hidden');
        document.getElementById('recommendation-form').reset();
    }
</script>
{% endblock %}
